[1mdiff --git a/luma-app/app/(tabs)/index.tsx b/luma-app/app/(tabs)/index.tsx[m
[1mindex 4a829c8..5dfd51a 100644[m
[1m--- a/luma-app/app/(tabs)/index.tsx[m
[1m+++ b/luma-app/app/(tabs)/index.tsx[m
[36m@@ -87,1033 +87,794 @@[m [mconst formatTaskDate = (dateValue: string | null): string => {[m
     } else if (diffDays > 0 && diffDays <= 7) {[m
       const weekDays = ['domingo', 'segunda', 'ter√ßa', 'quarta', 'quinta', 'sexta', 's√°bado'];[m
       const dayName = weekDays[taskDate.getDay()];[m
[31m-      return `${dayName.charAt(0).toUpperCase() + dayName.slice(1)} √†s ${timeStr}`;[m
[31m-    } else {[m
[31m-      const day = dayNum.toString().padStart(2, '0');[m
[31m-      const month = (monthNum + 1).toString().padStart(2, '0');[m
[31m-      return `${day}/${month}/${yearNum} √†s ${timeStr}`;[m
[31m-    }[m
[31m-  } catch (error) {[m
[31m-    return dateValue;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-// --- Componentes Atualizados para Light Theme ---[m
[31m-[m
[31m-const GlassCard = ({ children, style, variant = 'default' }: any) => {[m
[31m-  // Variants: default, primary (yellow tint), danger (red tint)[m
[31m-  const isPrimary = variant === 'primary';[m
[31m-[m
[31m-  return ([m
[31m-    <View style={[styles.glassCard, isPrimary && styles.glassCardPrimary, style]}>[m
[31m-      {/* Light theme: White blur instead of dark */}[m
[31m-      <BlurView intensity={20} tint="light" style={StyleSheet.absoluteFill} />[m
[31m-      <View style={{ backgroundColor: 'rgba(255,255,255,0.6)', ...StyleSheet.absoluteFillObject }} />[m
[31m-      <View style={{ zIndex: 10, flex: 1 }}>{children}</View>[m
[31m-    </View>[m
[31m-  );[m
[31m-};[m
[31m-[m
[31m-const StatCard = ({ icon: Icon, label, value, subtext, highlight = false }: any) => ([m
[31m-  <GlassCard style={styles.statCard}>[m
[31m-    <View style={styles.statHeader}>[m
[31m-      <Text style={styles.statLabel}>{label}</Text>[m
[31m-      {Icon && <Icon size={16} color={highlight ? Colors.secondary : Colors.textSecondary} />}[m
[31m-    </View>[m
[31m-    <Text style={styles.statValue} numberOfLines={1} adjustsFontSizeToFit>{value}</Text>[m
[31m-    {subtext && <Text style={styles.statSubtext}>{subtext}</Text>}[m
[31m-  </GlassCard>[m
[31m-);[m
[31m-[m
[31m-const ActivityItem = ({ icon: Icon, title, subtitle, time, type }: any) => ([m
[31m-  <View style={styles.activityItem}>[m
[31m-    <View style={styles.activityIconBg}>[m
[31m-      <Icon size={18} color={Colors.primary} />[m
[31m-    </View>[m
[31m-    <View style={{ flex: 1 }}>[m
[31m-      <Text style={styles.activityTitle} numberOfLines={1}>{title}</Text>[m
[31m-      <Text style={styles.activitySubtitle} numberOfLines={1}>{subtitle}</Text>[m
[31m-    </View>[m
[31m-    <Text style={styles.activityTime}>{time}</Text>[m
[31m-  </View>[m
[31m-);[m
[31m-[m
[31m-export default function Dashboard() {[m
[31m-  const router = useRouter();[m
[31m-  const params = useLocalSearchParams();[m
[31m-[m
[31m-  useEffect(() => {[m
[31m-    if (params.action === 'magic') {[m
[31m-      setModalMode('magic');[m
[31m-      setMagicInput('');[m
[31m-      setMagicPreview(null);[m
[31m-    }[m
[31m-  }, [params.action]);[m
[31m-[m
[31m-  const [modalMode, setModalMode] = useState<'finance' | 'task' | 'chat' | 'briefing' | 'magic' | 'user_menu' | null>(null);[m
[31m-  const [loading, setLoading] = useState(false);[m
[31m-  const [aiResponse, setAiResponse] = useState("");[m
[31m-  const [taskInput, setTaskInput] = useState("");[m
[31m-  const [chatInput, setChatInput] = useState("");[m
[31m-  const [magicInput, setMagicInput] = useState("");[m
[31m-  const [magicPreview, setMagicPreview] = useState<any | any[]>(null);[m
[31m-  const [selectedAssigneeId, setSelectedAssigneeId] = useState<string | null>(null);[m
[31m-  const [showAssigneeSelector, setShowAssigneeSelector] = useState(false);[m
[31m-  const [chatHistory, setChatHistory] = useState<{ role: 'user' | 'model', text: string }[]>([[m
[31m-    { role: 'model', text: "Ol√°! Sou a Luma. Como posso ajudar na gest√£o da casa hoje?" }[m
[31m-  ]);[m
[31m-  const signOut = useAuthStore(state => state.signOut);[m
[31m-[m
[31m-  // Auth Store[m
[31m-  const { user, houseId } = useAuthStore();[m
[31m-  const userId = user?.id || "";[m
[31m-  const userName = user?.name || "Usu√°rio";[m
[31m-  const houseName = "Minha Casa";[m
[31m-[m
[31m-  // Query Client[m
[31m-  const queryClient = useQueryClient();[m
[31m-[m
[31m-  // Buscar dados reais[m
[31m-  const { data: tasks = [], isLoading: tasksLoading } = useTasks(houseId);[m
[31m-  const { data: expenses = [], isLoading: expensesLoading } = useExpenses(houseId);[m
[31m-  const { data: members = [], isLoading: membersLoading } = useHouseMembers(houseId);[m
[31m-[m
[31m-  // Atualiza√ß√£o em tempo real[m
[31m-  useRealtimeTasks(houseId);[m
[31m-  useRealtimeExpenses(houseId);[m
[31m-[m
[31m-  const currentMonth = useMemo(() => {[m
[31m-    const now = new Date();[m
[31m-    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;[m
[31m-  }, []);[m
[32m+[m[32m      const [magicPreview, setMagicPreview] = useState<any | any[]>(null);[m
[32m+[m[32m      const [selectedAssigneeId, setSelectedAssigneeId] = useState<string | null>(null);[m
[32m+[m[32m      const [showAssigneeSelector, setShowAssigneeSelector] = useState(false);[m
[32m+[m[32m      const [chatHistory, setChatHistory] = useState<{ role: 'user' | 'model', text: string }[]>([[m
[32m+[m[32m        { role: 'model', text: "Ol√°! Sou a Luma. Como posso ajudar na gest√£o da casa hoje?" }[m
[32m+[m[32m      ]);[m
[32m+[m[32m      const signOut = useAuthStore(state => state.signOut);[m
[32m+[m
[32m+[m[32m      // Auth Store[m
[32m+[m[32m      const { user, houseId } = useAuthStore();[m
[32m+[m[32m      const userId = user?.id || "";[m
[32m+[m[32m      const userName = user?.name || "Usu√°rio";[m
[32m+[m[32m      const houseName = "Minha Casa";[m
[32m+[m
[32m+[m[32m      // Query Client[m
[32m+[m[32m      const queryClient = useQueryClient();[m
[32m+[m
[32m+[m[32m      // Buscar dados reais[m
[32m+[m[32m      const { data: tasks = [], isLoading: tasksLoading } = useTasks(houseId);[m
[32m+[m[32m      const { data: expenses = [], isLoading: expensesLoading } = useExpenses(houseId);[m
[32m+[m[32m      const { data: members = [], isLoading: membersLoading } = useHouseMembers(houseId);[m
[32m+[m
[32m+[m[32m      // Atualiza√ß√£o em tempo real[m
[32m+[m[32m      useRealtimeTasks(houseId);[m
[32m+[m[32m      useRealtimeExpenses(houseId);[m
[32m+[m
[32m+[m[32m      const currentMonth = useMemo(() => {[m
[32m+[m[32m        const now = new Date();[m
[32m+[m[32m        return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;[m
[32m+[m[32m      }, []);[m
[32m+[m
[32m+[m[32m      const { data: monthlyBudget } = useMonthlyBudget(houseId, currentMonth);[m
[32m+[m
[32m+[m[32m      const financialSummary = useMemo(() => {[m
[32m+[m[32m        const now = new Date();[m
[32m+[m[32m        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);[m
[32m+[m[32m        const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);[m
[32m+[m
[32m+[m[32m        const monthlyExpenses = expenses.filter(expense => {[m
[32m+[m[32m          const expenseDate = new Date(expense.expenseDate);[m
[32m+[m[32m          return expenseDate >= startOfMonth && expenseDate <= endOfMonth;[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        const spent = monthlyExpenses.reduce((sum, expense) => sum + Number(expense.amount), 0);[m
[32m+[m[32m        const limit = monthlyBudget ? Number(monthlyBudget.amount) : 0;[m
[32m+[m[32m        const percent = limit > 0 ? Math.round((spent / limit) * 100) : 0;[m
[32m+[m
[32m+[m[32m        return {[m
[32m+[m[32m          spent: spent.toFixed(2).replace('.', ','),[m
[32m+[m[32m          limit: limit.toFixed(2).replace('.', ','),[m
[32m+[m[32m          percent: Math.min(percent, 100)[m
[32m+[m[32m        };[m
[32m+[m[32m      }, [expenses, monthlyBudget, currentMonth]);[m
[32m+[m
[32m+[m[32m      const pendingTasksCount = useMemo(() => {[m
[32m+[m[32m        return tasks.filter(task => task.status === 'PENDING').length;[m
[32m+[m[32m      }, [tasks]);[m
[32m+[m
[32m+[m[32m      const topPendingTasks = useMemo(() => {[m
[32m+[m[32m        return tasks[m
[32m+[m[32m          .filter(t => t.status === 'PENDING')[m
[32m+[m[32m          .sort((a, b) => {[m
[32m+[m[32m            const dateA = a.dueDate ? new Date(a.dueDate).getTime() : Number.MAX_SAFE_INTEGER;[m
[32m+[m[32m            const dateB = b.dueDate ? new Date(b.dueDate).getTime() : Number.MAX_SAFE_INTEGER;[m
[32m+[m[32m            return dateA - dateB;[m
[32m+[m[32m          })[m
[32m+[m[32m          .slice(0, 3);[m
[32m+[m[32m      }, [tasks]);[m
[32m+[m
[32m+[m[32m      const recentActivity = useMemo(() => {[m
[32m+[m[32m        const recentExpenses = expenses[m
[32m+[m[32m          .sort((a, b) => new Date(b.expenseDate).getTime() - new Date(a.expenseDate).getTime())[m
[32m+[m[32m          .slice(0, 3)[m
[32m+[m[32m          .map(e => ({[m
[32m+[m[32m            id: e.id,[m
[32m+[m[32m            type: 'finance' as const,[m
[32m+[m[32m            title: e.description,[m
[32m+[m[32m            subtitle: `R$ ${Number(e.amount).toFixed(2)}`,[m
[32m+[m[32m            date: new Date(e.expenseDate),[m
[32m+[m[32m            time: new Date(e.expenseDate).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })[m
[32m+[m[32m          }));[m
[32m+[m
[32m+[m[32m        const recentTasks = tasks[m
[32m+[m[32m          .filter(t => t.status === 'COMPLETED')[m
[32m+[m[32m          .sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime())[m
[32m+[m[32m          .slice(0, 3)[m
[32m+[m[32m          .map(t => ({[m
[32m+[m[32m            id: t.id,[m
[32m+[m[32m            type: 'task' as const,[m
[32m+[m[32m            title: t.title,[m
[32m+[m[32m            subtitle: 'Conclu√≠da',[m
[32m+[m[32m            date: new Date(t.updatedAt),[m
[32m+[m[32m            time: new Date(t.updatedAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })[m
[32m+[m[32m          }));[m
[32m+[m
[32m+[m[32m        return [...recentExpenses, ...recentTasks][m
[32m+[m[32m          .sort((a, b) => b.date.getTime() - a.date.getTime())[m
[32m+[m[32m          .slice(0, 4);[m
[32m+[m[32m      }, [expenses, tasks]);[m
[32m+[m
[32m+[m[32m      // --- Handlers (Mantidos) ---[m
[32m+[m[32m      const handleMagicInput = async () => {[m
[32m+[m[32m        if (!magicInput.trim()) return;[m
[32m+[m[32m        if (!houseId || !userId) {[m
[32m+[m[32m          setAiResponse("Erro: Voc√™ precisa estar logado e ter uma casa selecionada.");[m
[32m+[m[32m          return;[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        setLoading(true);[m
[32m+[m[32m        setMagicPreview(null);[m
[32m+[m
[32m+[m[32m        // ... (L√≥gica de fallback e n8n mantida)[m
[32m+[m[32m        // Simplificando para brevidade, assumindo que a l√≥gica √© a mesma[m
[32m+[m
[32m+[m[32m        // Fallback logic simulada para n√£o quebrar[m
[32m+[m[32m        const results = [{[m
[32m+[m[32m          type: 'task' as const,[m
[32m+[m[32m          data: {[m
[32m+[m[32m            title: magicInput,[m
[32m+[m[32m            due_date: 'Hoje'[m
[32m+[m[32m          }[m
[32m+[m[32m        }];[m
[32m+[m
[32m+[m[32m        try {[m
[32m+[m[32m          // Chamada real ao n8n se necess√°rio[m
[32m+[m[32m          // ...[m
[32m+[m[32m        } catch (e) { }[m
[32m+[m
[32m+[m[32m        setMagicPreview(results);[m
[32m+[m[32m        setLoading(false);[m
[32m+[m[32m      };[m
[32m+[m
[32m+[m[32m      const handleConfirmMagic = async () => {[m
[32m+[m[32m        // ... (L√≥gica de confirma√ß√£o mantida)[m
[32m+[m[32m        setModalMode(null);[m
[32m+[m[32m        setMagicInput("");[m
[32m+[m[32m        setMagicPreview(null);[m
[32m+[m[32m      };[m
[32m+[m
[32m+[m[32m      const handleFinancialInsight = async () => {[m
[32m+[m[32m        setModalMode('finance');[m
[32m+[m[32m        // ...[m
[32m+[m[32m      };[m
[32m+[m
[32m+[m[32m      const handleSmartTask = async () => {[m
[32m+[m[32m        // ...[m
[32m+[m[32m      };[m
[32m+[m
[32m+[m[32m      const handleDailyBriefing = async () => {[m
[32m+[m[32m        setModalMode('briefing');[m
[32m+[m[32m        // ...[m
[32m+[m[32m      };[m
[32m+[m
[32m+[m[32m      const handleSendMessage = async () => {[m
[32m+[m[32m        if (!chatInput.trim()) return;[m
[32m+[m[32m        setChatHistory(prev => [...prev, { role: 'user', text: chatInput }]);[m
[32m+[m[32m        setChatInput("");[m
[32m+[m[32m        // ...[m
[32m+[m[32m      };[m
[32m+[m
[32m+[m[32m      const renderModalContent = () => {[m
[32m+[m[32m        const isChat = modalMode === 'chat';[m
[32m+[m[32m        const isTask = modalMode === 'task';[m
[32m+[m[32m        const isBriefing = modalMode === 'briefing';[m
[32m+[m[32m        const isFinance = modalMode === 'finance';[m
[32m+[m[32m        const isMagic = modalMode === 'magic';[m
[32m+[m[32m        const isUserMenu = modalMode === 'user_menu';[m
[32m+[m
[32m+[m[32m        return ([m
[32m+[m[32m          <KeyboardAvoidingView behavior={Platform.OS === "ios" ? "padding" : "height"} style={{ flex: 1 }}>[m
[32m+[m[32m            <View style={styles.modalHeader}>[m
[32m+[m[32m              <View style={{ flexDirection: 'row', alignItems: 'center', gap: 8 }}>[m
[32m+[m[32m                {isUserMenu ? <User size={20} color={Colors.primary} /> : <Sparkles size={20} color={Colors.primary} />}[m
[32m+[m[32m                <Text style={styles.modalTitle}>[m
[32m+[m[32m                  {isChat ? 'Luma Chat' : isTask ? 'Planejador M√°gico' : isBriefing ? 'Resumo do Dia' : isMagic ? 'Cria√ß√£o M√°gica' : isUserMenu ? 'Perfil' : 'An√°lise Financeira'}[m
[32m+[m[32m                </Text>[m
[32m+[m[32m              </View>[m
[32m+[m[32m              <TouchableOpacity onPress={() => {[m
[32m+[m[32m                setModalMode(null);[m
[32m+[m[32m                setAiResponse('');[m
[32m+[m[32m                setMagicPreview(null);[m
[32m+[m[32m                setSelectedAssigneeId(null);[m
[32m+[m[32m                setShowAssigneeSelector(false);[m
[32m+[m[32m              }}>[m
[32m+[m[32m                <X size={24} color={Colors.textSecondary} />[m
[32m+[m[32m              </TouchableOpacity>[m
[32m+[m[32m            </View>[m
 [m
[31m-  const { data: monthlyBudget } = useMonthlyBudget(houseId, currentMonth);[m
[32m+[m[32m            <View style={styles.modalBody}>[m
[32m+[m[32m              {/* User Menu Modal */}[m
[32m+[m[32m              {isUserMenu && ([m
[32m+[m[32m                <View style={{ gap: 16 }}>[m
[32m+[m[32m                  <TouchableOpacity style={styles.menuItem} onPress={() => setModalMode(null)}>[m
[32m+[m[32m                    <View style={styles.menuIconBg}>[m
[32m+[m[32m                      <User size={20} color={Colors.primary} />[m
[32m+[m[32m                    </View>[m
[32m+[m[32m                    <Text style={styles.menuItemText}>Meu Perfil</Text>[m
[32m+[m[32m                  </TouchableOpacity>[m
 [m
[31m-  const financialSummary = useMemo(() => {[m
[31m-    const now = new Date();[m
[31m-    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);[m
[31m-    const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);[m
[31m-[m
[31m-    const monthlyExpenses = expenses.filter(expense => {[m
[31m-      const expenseDate = new Date(expense.expenseDate);[m
[31m-      return expenseDate >= startOfMonth && expenseDate <= endOfMonth;[m
[31m-    });[m
[31m-[m
[31m-    const spent = monthlyExpenses.reduce((sum, expense) => sum + Number(expense.amount), 0);[m
[31m-    const limit = monthlyBudget ? Number(monthlyBudget.amount) : 0;[m
[31m-    const percent = limit > 0 ? Math.round((spent / limit) * 100) : 0;[m
[31m-[m
[31m-    return {[m
[31m-      spent: spent.toFixed(2).replace('.', ','),[m
[31m-      limit: limit.toFixed(2).replace('.', ','),[m
[31m-      percent: Math.min(percent, 100)[m
[31m-    };[m
[31m-  }, [expenses, monthlyBudget, currentMonth]);[m
[31m-[m
[31m-  const pendingTasksCount = useMemo(() => {[m
[31m-    return tasks.filter(task => task.status === 'PENDING').length;[m
[31m-  }, [tasks]);[m
[31m-[m
[31m-  const topPendingTasks = useMemo(() => {[m
[31m-    return tasks[m
[31m-      .filter(t => t.status === 'PENDING')[m
[31m-      .sort((a, b) => {[m
[31m-        const dateA = a.dueDate ? new Date(a.dueDate).getTime() : Number.MAX_SAFE_INTEGER;[m
[31m-        const dateB = b.dueDate ? new Date(b.dueDate).getTime() : Number.MAX_SAFE_INTEGER;[m
[31m-        return dateA - dateB;[m
[31m-      })[m
[31m-      .slice(0, 3);[m
[31m-  }, [tasks]);[m
[31m-[m
[31m-  const recentActivity = useMemo(() => {[m
[31m-    const recentExpenses = expenses[m
[31m-      .sort((a, b) => new Date(b.expenseDate).getTime() - new Date(a.expenseDate).getTime())[m
[31m-      .slice(0, 3)[m
[31m-      .map(e => ({[m
[31m-        id: e.id,[m
[31m-        type: 'finance' as const,[m
[31m-        title: e.description,[m
[31m-        subtitle: `R$ ${Number(e.amount).toFixed(2)}`,[m
[31m-        date: new Date(e.expenseDate),[m
[31m-        time: new Date(e.expenseDate).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })[m
[31m-      }));[m
[31m-[m
[31m-    const recentTasks = tasks[m
[31m-      .filter(t => t.status === 'COMPLETED')[m
[31m-      .sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime())[m
[31m-      .slice(0, 3)[m
[31m-      .map(t => ({[m
[31m-        id: t.id,[m
[31m-        type: 'task' as const,[m
[31m-        title: t.title,[m
[31m-        subtitle: 'Conclu√≠da',[m
[31m-        date: new Date(t.updatedAt),[m
[31m-        time: new Date(t.updatedAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })[m
[31m-      }));[m
[31m-[m
[31m-    return [...recentExpenses, ...recentTasks][m
[31m-      .sort((a, b) => b.date.getTime() - a.date.getTime())[m
[31m-      .slice(0, 4);[m
[31m-  }, [expenses, tasks]);[m
[31m-[m
[31m-  // --- Handlers (Mantidos) ---[m
[31m-  const handleMagicInput = async () => {[m
[31m-    if (!magicInput.trim()) return;[m
[31m-    if (!houseId || !userId) {[m
[31m-      setAiResponse("Erro: Voc√™ precisa estar logado e ter uma casa selecionada.");[m
[31m-      return;[m
[31m-    }[m
[32m+[m[32m                  <TouchableOpacity style={styles.menuItem} onPress={() => {[m
[32m+[m[32m                    setModalMode(null);[m
[32m+[m[32m                    router.push('/(tabs)/house' as any);[m
[32m+[m[32m                  }}>[m
[32m+[m[32m                    <View style={styles.menuIconBg}>[m
[32m+[m[32m                      <Home size={20} color={Colors.primary} />[m
[32m+[m[32m                    </View>[m
[32m+[m[32m                    <Text style={styles.menuItemText}>Minha Casa</Text>[m
[32m+[m[32m                  </TouchableOpacity>[m
 [m
[31m-    setLoading(true);[m
[31m-    setMagicPreview(null);[m
[31m-[m
[31m-    // ... (L√≥gica de fallback e n8n mantida)[m
[31m-    // Simplificando para brevidade, assumindo que a l√≥gica √© a mesma[m
[31m-[m
[31m-    // Fallback logic simulada para n√£o quebrar[m
[31m-    const results = [{[m
[31m-      type: 'task' as const,[m
[31m-      data: {[m
[31m-        title: magicInput,[m
[31m-        due_date: 'Hoje'[m
[31m-      }[m
[31m-    }];[m
[31m